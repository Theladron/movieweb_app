<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/movies.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user_movies.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/recommendations.css') }}">
    <title>User's Movies</title>
</head>
<body class="user_movies">
    <nav>
        <a href="/"><button>Home</button></a>
        <a href="/movies"><button>Movies</button></a>
        <a href="/users"><button>Users</button></a>
    </nav>
    <div class="user_title">
        <h1 class="title">{{ user.name }}'s Movies</h1>
    </div>

    <!-- Recommendations container - dynamically populated by JavaScript -->
    <div id="recommendations_container" class="recommendations_container"></div>

    <section class="movies_container">
        {% if movies %}
            {% for movie in movies %}
                <div class="movie_card">
                    <img src="{{ movie.poster }}" class="movie_poster">
                    <div class="movie_details">
                        <h3 class="movie_title">{{ movie.title }}</h3>
                        <p class="movie_year"><strong>Release year:</strong> <span class="year">{{ movie.release_year }}</span></p>
                        <div class="movie_rating">
                            <strong>Your Rating:</strong>
                            <span>‚≠ê {% if movie.user_rating is not none %}{{ movie.user_rating }}{% else %}{{ movie.rating }}{% endif %}</span>
                        </div>
                        <p class="movie_director"><strong>Director:</strong> <span class="name">{{ movie.director }}</span></p>
                    </div>
                    <div class="movie_actions">
                        <button type="button" class="recommend_button" onclick="handleRecommendationsClick('{{ movie.title|replace("'", "\\'") }}')">
                            <span>üé¨</span>
                            <span>Suggest Similar Movies</span>
                        </button>
                        <a href="{{ url_for('movie.update_movie', user_id=user.id, movie_id=movie.id) }}" class="action_icon">
                            <span class="icon">‚úèÔ∏è</span>
                            <span>Update</span>
                        </a>
                        <form action="{{ url_for('movie.delete_movie', user_id=user.id, movie_id=movie.id) }}" method="GET">
                            <button type="submit" class="remove_button">
                                <span class="icon">üóëÔ∏è</span>
                                <span>Delete</span>
                            </button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="no_movies_message"><strong>No movies added for {{ user.name }} yet.</strong></p>
        {% endif %}
    </section>
    <div class="user-actions-bottom">
        <a href="/users/{{ user.id }}/add_movie" class="add-user-btn">Add Movie</a>
        <a href="/users" class="back-users-btn">Back to Users</a>
    </div>
    {% if message %}
    <p class="alert-message">{{ message }}</p>
    {% endif %}
    
    <script src="{{ url_for('static', filename='js/movie_recommendations.js') }}"></script>
</body>
</html>
